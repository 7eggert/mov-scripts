#!/bin/sh
pmv  \
'goto finally if / of/;'\
's/^Serien - (\d+ of \d+)\s+([^-.]+)( -|\.)/$2 - $1$3/ && return;'\
'my $done=0;'\
'{ $done = 1 if s/^(.*) - (?:(.*?) )?\((\d+)__(\d+)\)/'\
'	$n=length($4);'\
'	sprintf("%s - %$n.${n}d of %d%s",$1,$3,$4,($2 eq "" ? "" : " $2"));/e;'\
'   s/(.*) - (.*?) - (\d+ of \d+)/$1 - $3 $2/; };'\
's/^(\d+ of \d+) (.*?) - /$2 - $1 /;'\
'goto finally if $done;'\
''\
'{ $done = 1 if s/^([^-]*) \((\d+)__(\d+)\)/'\
'	$n=length($3);'\
'	sprintf("%s - %$n.${n}d of %d",$1,$2,$3);/e; };'\
's/^(\d+ of \d+) (.*?) - /$2 - $1 /;'\
'goto finally if $done;'\
''\
'finally:'\
'if (/^([^-_]+)_ ([^-]*?) - (\d+) of (\d+)((?: - .*)?\.\w+)$/) {'\
'  $_="$1 - $3 of $4 $2$5";'\
'}'\
'' "$@"

#pmv  \
#'{ s/^(.*) - (?:(.*?) )?\((\d+)__(\d+)\)/'\
#'	$n=length($4);'\
#'	sprintf("%s - %$n.${n}d of %d%s",$1,$3,$4,($2 eq "" ? "" : " $2"));/e;'\
#'  s/(.*) - (.*?) - (\d+ of \d+)/$1 - $3 $2/; }' "$@"

#Serien - 9 of 18 Name
#pmv s/'(\d+ of \d+)\s+([^-.]+)( -|\.)/$2 - $1$3/'